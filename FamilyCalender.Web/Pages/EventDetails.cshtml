@page
@model FamilyCalender.Web.Pages.EventDetailsModel

<div>
	<h3>@Model.EventDetails.Title</h3>
	<div>
		<strong>Kalender:</strong> @Model.EventDetails.Calendar.Name
	</div>
	<div>
		<strong>Datum:</strong>
		<ul>
			@foreach (var date in Model.EventDetails.EventDates)
			{
				<li>@date.Date.ToString("yyyy-MM-dd")</li>
			}
		</ul>
	</div>
	<div>
		<strong>Medlemmar:</strong>
		<ul>
			@foreach (var member in Model.EventDetails.MemberEvents)
			{
				<li>@member.Member.Name</li>
			}
		</ul>
	</div>

	<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editEventModal">
		Redigera Event
	</button>
</div>

<!-- Modal för att redigera eventet -->
<div class="modal fade" id="editEventModal" tabindex="-1" aria-labelledby="editEventModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form method="post" asp-page-handler="UpdateEvent">

				<div class="modal-header">
					<h5 class="modal-title" id="editEventModalLabel">Redigera Event</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Stäng"></button>
				</div>

				<div class="modal-body">

					<div class="mb-3">
						<label for="editEventTitle" class="form-label">Ändra titel</label>
						<input type="text" class="form-control" value="@Model.EventDetails.Title" asp-for=NewTitle id="editEventTitle" />
					</div>

					<div class="mb-3">
						<label for="editEventDates" class="form-label">Ändra datum för valt event</label>
						<input type="date" class="form-control" value="@Model.Day.Value.ToString("yyyy-MM-dd")" asp-for="NewDate" id="editEventDates" />

					</div>

					@if (Model.EventDetails.EventDates.Count > 1)
					{
						var minEventDate = Model.EventDetails.EventDates.Min(x => x.Date) < DateTime.Today ? DateTime.Today : Model.EventDetails.EventDates.Min(x => x.Date);
						var maxEventDate = Model.EventDetails.EventDates.Max(x => x.Date);

						<div class="accordion" id="eventOptionsAccordion">
							<div class="accordion-item">
								<h2 class="accordion-header" id="headingTwo">
									<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
										Uppdatera intervall
									</button>
								</h2>
								<div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#eventOptionsAccordion">
									<div class="accordion-body">
										<div class="mb-3">
											<label for="editStartDate" class="form-label">Välj nytt startdatum</label>
											<input type="date" class="form-control" asp-for="StartDate" value="@minEventDate.ToString("yyyy-MM-dd")" id="editStartDate" />
											<small id="error-start-date" class="text-danger d-none"></small>


										</div>

										<div class="mb-3">
											<label for="editEndDate" class="form-label">Välj nytt slutdatum</label>
											<input type="date" class="form-control" asp-for="EndDate" value="@maxEventDate.ToString("yyyy-MM-dd")" id="editEndDate" />
											<small id="error-end-date" class="text-danger d-none"></small>

										</div>
										<div class="mb-3">
											<label class="form-label">Välj dagar</label>
											<div>
												<input type="checkbox" name="SelectedDays" value="Monday" @(Model.SelectedDays.Contains(DayOfWeek.Monday) ? "checked" : "") /> Måndag <br />
												<input type="checkbox" name="SelectedDays" value="Tuesday" @(Model.SelectedDays.Contains(DayOfWeek.Tuesday) ? "checked" : "") /> Tisdag <br />
												<input type="checkbox" name="SelectedDays" value="Wednesday" @(Model.SelectedDays.Contains(DayOfWeek.Wednesday) ? "checked" : "") /> Onsdag <br />
												<input type="checkbox" name="SelectedDays" value="Thursday" @(Model.SelectedDays.Contains(DayOfWeek.Thursday) ? "checked" : "") /> Torsdag <br />
												<input type="checkbox" name="SelectedDays" value="Friday" @(Model.SelectedDays.Contains(DayOfWeek.Friday) ? "checked" : "") /> Fredag <br />
												<input type="checkbox" name="SelectedDays" value="Saturday" @(Model.SelectedDays.Contains(DayOfWeek.Saturday) ? "checked" : "") /> Lördag <br />
												<input type="checkbox" name="SelectedDays" value="Sunday" @(Model.SelectedDays.Contains(DayOfWeek.Sunday) ? "checked" : "") /> Söndag
											</div>
										</div>

										<small id="error-right-weekdays" class="text-danger d-none"></small>
										<small id="error-interval-weekdays" class="text-danger d-none"></small>


									</div>
									<div class="mb-3 ms-3 form-check">
										<input type="checkbox" class="form-check-input" id="updateInterval" name="UpdateInterval" asp-for="@Model.UpdateInterval" />
										<label class="form-check-label fw-bold" for="updateInterval">Uppdatera hela intervallet</label>
									</div>
								</div>
							</div>

						</div>
					}

					<div class="mb-3">
						<label for="editMemberList" class="form-label">Välj vilka medlemmar det gäller</label>
						<div id="editMemberList">
							@foreach (var member in Model.Members)
							{
								var isChecked = Model.EventDetails.MemberEvents.Any(e => e.Member.Id == member.Id);

								<div class="form-check">
									<input class="form-check-input member-checkbox"
										   type="checkbox"
										   id="editMember-@member.Id"
										   value="@member.Id"
										   name="selectedMemberIds"
									@(isChecked ? "checked" : "") />
									<label class="form-check-label" for="editMember-@member.Id">@member.Name</label>
								</div>
							}
						</div>
						<small id="memberError" class="text-danger d-none">Du måste välja minst en medlem</small>
					</div>


				</div>
				<div class="modal-footer">
					<input type="hidden" asp-for="EventId" value="@Model.EventDetails.Id" />
					<button type="submit" class="btn btn-primary">Spara ändringar</button>
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Stäng</button>
				</div>
			</form>
		</div>
	</div>
</div>